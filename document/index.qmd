---
title: "Einsatz von Bilderkennung mittels neuronalen Netzwerken in der Fischzucht der BAW in Kreuzstein"
author:
  - name: Anna Dünser 
    orcid: 0000-0002-0761-8490
    email: anna.duenser@baw.at
    affiliation: Bundesamt für Wasserwirtschaft; Institut für Gewässerökologie und Fischereiwirtschaft
  - name: Franz Lahnsteiner 
    email: franz.lahnsteiner@baw.at
    affiliation: Bundesamt für Wasserwirtschaft; Institut für Gewässerökologie und Fischereiwirtschaft
  - name: Hannes Oberreiter 
    affiliation: 'Privat'
    orcid: 0000-0003-1019-1245
    email: hoberreiter@gmail.com
date: "11/12/2022"
bibliography: "references.bib"
link-citations: true
lang: de
editor:
  render-on-save: true
citation:
  url: https://github.com/HannesOberreiter/baw-fish-cell-yolo
crossref:
  fig-title: Abb.
  tbl-title: Tabelle
---

## Einführung

Die Dichte von rote Blutkörperchen (auch bekannt als Hämatokrit) wird bei uns am BAW bei verschiedenen Projekten gemessen, um Informationen über die Gesundheit und Physiologie der Fische zu erhalten. Rote Blutkörperchen (Erythrozyten) transportieren Sauerstoff von den Kiemen des Fisches zu den Geweben und Organen, und eine Änderung der Dichte kann darauf hinweisen, dass der Sauerstofftransport im Körper des Fisches gestört ist.

Eine veränderte Erythrozytendichte kann auch auf verschiedene Erkrankungen oder Stressreaktionen hinweisen. Zum Beispiel kann eine Erhöhung der Erythrozytendichte bei Fischen auf eine Infektion, Dehydration oder eine Erhöhung des Hämoglobinspiegels im Blut hinweisen, während eine Verringerung der Erythrozytendichte auf Anämie, Blutverlust oder eine Verringerung des Hämoglobinspiegels im Blut hinweisen kann. 

Ein Beispiel für eine Stressreaktion ist eine Veränderte Umwelt, wie zum Beispiel die Eröhung der Gewässer Temperaturen. Hier können bereits recht früh durch physiologische Untersuchungen wie der Bestimmung des Hämatokrit leichte Veränderungen wahrgenommen werden.

Die Erythrozytendichte kann in einer Burker-Türk-Zählkammer bestimmt werden. Diese Art von Zählkammer besteht aus einer rechteckigen Glasplatte mit einer dünnen, rechteckigen Kammer in der Mitte, die in einem Gitternetz unterteilt ist. Um die Zellen zu zählen, wird eine verdünnte Blutprobe in die Kammer gegeben. Die Zellen verteilen sich gleichmäßig auf der Glasplatte und werden dann unter einem Mikroskop betrachtet. Das Gitternetz auf der Kammer ermöglicht es, den Bereich der Kammer zu berechnen und somit die Anzahl der Zellen pro Volumeneinheit zu bestimmen.

Bei der Zählung wird die Anzahl der Zellen in mehreren Feldern des Gitternetzes gezählt und dann der Durchschnitt berechnet. Basierend auf der Größe des Feldes und der Gesamtzahl der Zellen in diesen Feldern kann die Gesamtzahl der Zellen in der Probe berechnet werden.


## Neuronales Netz YOLOv5

Das manuelle Zählen von Blutzellen ist ein zeitaufwändiger Prozess und birgt aufgrund der subjektiven Wahrnehmung der auszählenden Person auch ein gewisses Fehlerpotenzial. Eine mögliche Lösung besteht in der Nutzung von automatischen optischen Bilderkennungssystemen, die heutzutage weit verbreitet sind und eine immer bessere Leistung erbringen. Ein vielversprechender Ansatz ist die Verwendung von neuronalen Netzwerken für die automatische Bildsegmentierung. Eine solche Architektur, die oft eingesetzt wird, ist YOLO, was für "You only look once" steht. Der zugrunde liegende Algorithmus basiert auf einem Convolutional Neural Network (CNN), das auch in der Landwirtschaft und anderen Bereichen eingesetzt wird. Es gibt verschiedene Architekturen wie R-CNN (Region-based Convolutional Networks) oder R-FCN (Region based Fully Convolutional Networks), die jeweils unterschiedliche Stärken aufweisen, je nach Anwendung. Die meisten dieser Architekturen können relativ einfach von Nutzern in TensorFlow, einer Open-Source-Plattform für maschinelles Lernen von Google, erstellt und bereitgestellt werden.

Die von uns verwendete YOLO-Architektur wurde im Jahr 2015 veröffentlicht [@yolo]. Der zugrundeliegende Algorithmus unterteilt jedes Bild in ein Grid-System, wobei jede Zelle des Grids für die Erkennung von Objekten verantwortlich ist. Obwohl diese Methode durch eine schnelle Erkennung und ein schnelles Training gekennzeichnet ist, hat sie Schwierigkeiten bei der Identifikation sehr kleiner Objekte. Im Laufe der Zeit wurden jedoch diese Einschränkungen in jeder neuen Version der Architektur verbessert, und YOLO bietet mittlerweile eine hohe Genauigkeit. Seit Version 2 ist YOLO ein "Fully Convolutional Network" (FCN) [@nakahara2018].

In unserem Fall haben wir YOLOv5 eingesetzt [@yolov5]. Diese Version bietet bereits trainierte Modelle, eine hervorragende Dokumentation und eine unabhängige Funktionalität. Darüber hinaus ist es auf dem Python-basierten PyTorch-Framework [@pytorch] aufgebaut, was es auch Personen mit begrenzten Programmierkenntnissen ermöglicht, einfache Modelle zu erstellen und zu verwenden. Die Weiterentwicklung basiert aber äußert schnell in diesem Bereich und mittlerweile mit Stand 2023 gibt es auch bereits YOLOv8.

## Methodik und Resultate

Für unseren Fall haben 17 Bilder zuerst annotiert sowie zwei negativ Kontrollen mit einem bereits gewichteten Model (yolov5s, COCO128 Datensatz) als Start Punkt trainiert. Validation, also die Kontrolle wie gut die Daten sind wurde mit X Bildern durchgeführt. Was zu einer Erfolgsrate von XXX führte.

Die "Confusion" Matrix ist ein Werkzeug in der Maschinellen Lernforschung, das verwendet wird, um die Leistung eines Klassifikators zu bewerten, zum Beispiel: Genauigkeit, Sensitivität und Spezifität. In unserem Fall zeigt eine sehr geringe Abweichung zu den "wahren" Ergebnissen (@fig-confusion).

![Confusion Matrix mit den viert Hauptwerten: true positives (wahre Positivwerte), false positives (falsche Positivwerte), true negatives (wahre Negativwerte) und false negatives (falsche Negativwerte).](img/confusion_matrix.png){#fig-confusion}

Als Beispiel wie eine Validierung aussieht, ist in @fig-validation ein annotiertes Bild, also von uns markierte Blutzellen, und ein Bild wie es vom Alorithmus erkannt wurde angehängt worden. Dabei setzt der Alroithmus auch automatisch einen Prozentwert, die die Wahrscheinlichkeit wiederspiegelt ob es sich um eine Blutzelle handelt.

::: {#fig-validation layout-ncol=2}

![Annotierte Blutzellen](img/val_batch0_labels.jpg){#fig-label}

![Erkannte Blutzellen mit Prozentwert](img/val_batch0_pred.jpg){#fig-pred}


Beispielbild aus dem Validierungsdatensatz, Unterschied zwischen annotierte Blutzellen und erkannten Blutzellen mit Prozentwert der Wahrscheinlichkeit.
:::

Unser Projekt und die Trainingsdaten sind Open Source unter folgenden Link zu finden [GitHub](https://github.com/HannesOberreiter/baw-fish-cell-yolo).


## Diskussion

Durch die Implementierung von automatischer Bilderkennung konnte die Arbeitsabläufe in unserem Institut automatisiert werden. Dabei wurde das Potenzial innovativer Methoden genutzt, um bewährte Technologien mit modernen Verfahren zu kombinieren. Die angewandte Methode ist jedoch stets offen für weitere Verbesserungen. Ein neuronales Netzwerk für die vergleichsweise einfache Aufgabe des Zählens von Blutzellen ist jedoch als überdimensioniert anzusehen, da simpelere Verfahren wie die Konturbilderkennung voraussichtlich ähnliche Ergebnisse geliefert hätten, aber diese wieder Fehleranfälliger für unterschiedliche Lichtverhältnisse beim Fotografieren wäre. Nichtsdestotrotz haben uns die vergleichsweise einfache Anwendung und die sehr guten Ergebnisse, auch bei unterschiedlicher Bildqualität, von der Wirksamkeit der implementierten Methode überzeugt und es ermöglicht, innerhalb kurzer Zeit ein effektives System aufzubauen.



### Referenzen

::: {#refs}
:::